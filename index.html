
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>落落无尘</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Jezhee">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="落落无尘">
<meta property="og:url" content="http://weixinfu.com/index.html">
<meta property="og:site_name" content="落落无尘">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="落落无尘">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="落落无尘" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="落落无尘" title="落落无尘"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="落落无尘">落落无尘</a></h1>
				<h2 class="blog-motto">闲看庭前花开花落</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<!--form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:weixinfu.com">
					</form -->
					
					</li>
				</ul>
			</nav>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install','y4E6-M9Mvg9xHsysWL7g','2.0.0');
</script>
	
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/08/01/embedded_scrollview/" title="ScrollView嵌套GridView的处理" itemprop="url">ScrollView嵌套GridView的处理</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jezhee" target="_blank" itemprop="author">Jezhee</a>
		
  <p class="article-time">
    <time datetime="2015-08-01T06:54:00.000Z" itemprop="datePublished"> 发表于 2015-08-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在项目里面，有一个页面，整体是一个ScrollView，展示的是一个配置页面，其中一个子控件是一张包含多个缩略图的大图。 近期，策划提出一个新需求，要把原本这个整张的缩略图拆开为一张张的小图，以便单独响应点击事件。初一看，一个GridView替上去不就完事了嘛，再改改GridView的OnMeasure，让它的高度自适应放到ScrollView里面，这活似乎就完成的妥妥的了。</p>
<p>但紧接着，奇怪的事情发生了，如果gridview里元素比较少时，表现正常，但如果元素较多，ScrollView可以滚动的时候，就发现每次进入这个Activity，都是定位到最底部，如果元素更多一点，位置则固定在了GridView的顶部。看了半天代码，我没有做scrollTo的操作啊，再把其他不相干的代码回滚，还是无效。在我的项目里面，ScrollView套GridView还有另外一个地方，但那里表现的好好的，开始那里GridView是在顶上，正常，我想，那把GridView放到最底下再试试，x，还是正常。</p>
<p>郁闷了，没辙，只好google一下。很快，找到解决办法了，<code>GridView#setFcous(false)</code>。一试，还真可以。这我就奇怪了，跟这有毛线关系？跟踪代码看看吧。</p>
<p>要滚动到GridView位置，肯定会调用到scrollTo吧，和setFocus有关系，肯定会有requestFocus的地方吧，那就在这两个地方下断点，看看调用堆栈。果然，原因立马就找到了。首先，ScrollView布局完成后，会调用requestFocus，跟踪View#requestFocu的代码，一路往下调用了：</p>
<blockquote>
<p>private boolean requestFocusNoSearch(int direction, Rect previouslyFocusedRect);</p>
<p>void handleFocusGainInternal(int direction, Rect previouslyFocusedRect);</p>
<p>ScrollView#requestChildFocus(View child, View focused);</p>
</blockquote>
<p>答案就在requestChildFocus这个函数里面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动到请求focus的子控件处。</span></span><br><span class="line"><span class="keyword">if</span> (!mIsLayoutDirty) &#123;</span><br><span class="line">    scrollToChild(focused); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// The child may not be laid out yet, we can't compute the scroll yet</span></span><br><span class="line">    mChildToScrollTo = focused;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实也很好理解，就像你一个页面上放了一个EditText，当进入这个页面时，肯定会希望系统滚动到你的输入框这里。</p>
<p>剩下另外一个问题了：为什么另外一个页面把GridView放到最底下了，它却没有跟着滑下去呢？答案也很好找，因为处理就在挨着requestChildFocus这个函数下面的这个函数里。先看说明：</p>
<blockquote>
<p>When looking for focus in children of a scroll view, need to be a little more careful not to give focus to something that is scrolled off screen. This is more expensive than the default android.view.ViewGroupimplementation, otherwise this behavior might have been made the default.<br>protected boolean onRequestFocusInDescendants(int direction, Rect previouslyFocusedRect);</p>
</blockquote>
<p>其中有这样一个判断：if (isOffScreen(nextFocus)) return false;<br>验证一下，把在最底下的GridView放到中间来，再进去，果然就滚到GridView的位置了。</p>
<p>再想一想，既然是这样的原因，那其实只要在ScrollView里面放能获取Focus的控件，都会有这个问题，比如ListView，EditText等等，ScrollView会定位到它找到的第一个Focusable Child。<br>衍生一下，在解决问题的过程中，我还发现如果在初始化的时候如果先初始化GridView，设好adapter，然后在初始化adapter的数据源，且不调用BaseAdapter#notifyDataSetChanged,也不会有问题，为啥呢？答案在BaseAdapter的setAdapter函数里面，其中会有checkFocus，如果adapter getCount返回为0，GridView不能获得焦点。而GridView在layout时，它的数据源又已经有了，所以也能够正常的把所有元素布局和绘制出来。当然了，如果后面有数据改动，那么立马就会被打回原形。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/UI/">UI</a><a href="/tags/android/">android</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/28/black_technology_in_alipay/" title="支付宝后台不死的黑科技" itemprop="url">支付宝后台不死的黑科技</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jezhee" target="_blank" itemprop="author">Jezhee</a>
		
  <p class="article-time">
    <time datetime="2015-07-28T13:13:17.000Z" itemprop="datePublished"> 发表于 2015-07-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>近期支付宝升级到了9.0，除了加入微信功能外，还新增了金钟罩功能，不要说普通的各种加速球，火箭神马的不能杀死他外，连格外牛逼的绿色守护也奈何不了他。在绿色守护里面，支付宝始终显示为“服务正在被 支付宝 使用”，不会自动休眠，恼火死了。那么问题来了，他是怎么做到的呢？<br>
        
        
        <p class="article-more-link">
          
            <a href="/2015/07/28/black_technology_in_alipay/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/黑科技/">黑科技</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/15/Road_to_Build_Site/" title="基于Github pages使用hexo建立本博客的步骤记录" itemprop="url">基于Github pages使用hexo建立本博客的步骤记录</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jezhee" target="_blank" itemprop="author">Jezhee</a>
		
  <p class="article-time">
    <time datetime="2015-07-15T13:47:17.000Z" itemprop="datePublished"> 发表于 2015-07-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>github pages目前看起来是程序员最喜欢的建静态博客的方法了。本文记录一下我建这个博客的过程，留备查看。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2015/07/15/Road_to_Build_Site/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/github/">github</a><a href="/tags/hexo/">hexo</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/07/13/Android 5.0的坑/" title="Android 5.0的坑" itemprop="url">Android 5.0的坑</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Jezhee" target="_blank" itemprop="author">Jezhee</a>
		
  <p class="article-time">
    <time datetime="2015-07-13T13:47:17.000Z" itemprop="datePublished"> 发表于 2015-07-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>从用户角度讲，Android L算的上有屎以来最棒的Android系统，无论外观，还是性能，android 5都绝对是最高点。相较于它的前辈们，各方面的提升都相当明显。从体验上讲，离iOS距离越来越近了。当然，如果不是操蛋的墙，使得google service除了耗电别无二用的话， 这个距离还可以更小。</p>
<p>然而，不是一切都是美好。比如对于码农来讲，新的系统出来，老的代码就必然就会伴随着一番折腾。下面我们就来挑几个说说。</p>
        
        
        <p class="article-more-link">
          
            <a href="/2015/07/13/Android 5.0的坑/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Android/">Android</a><a href="/tags/陷阱/">陷阱</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Android/" title="Android">Android<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/黑科技/" title="黑科技">黑科技<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/github/" title="github">github<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/hexo/" title="hexo">hexo<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/陷阱/" title="陷阱">陷阱<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/android/" title="android">android<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/UI/" title="UI">UI<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="Jezhee">Jezhee</a>
		
		
		</p>

</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
